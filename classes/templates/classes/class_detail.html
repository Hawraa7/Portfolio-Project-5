{% extends "base.html" %}
{% load static %}

{% block meta_description %}
Join our fitness class: {{ class.name }}. Improve your health with expert trainers at Zouzou's Fitness.
{% endblock %}

{% block title %}
{{ class.name }} - Zouzou's Fitness
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'classes/css/classes.css' %}">
{% endblock %}

{% block content %}
<div class="class-detail-container container mt-5">
    <h2 class="class-detail-title">{{ class.title }}</h2>

    <p><strong>Instructor:</strong> {{ class.instructor }}</p>
    <p><strong>Date:</strong> {{ class.date|date:"M d, Y" }}</p>
    <p><strong>Time:</strong> {{ class.time|time:"H:i" }}</p>
    <p>{{ class.description }}</p>
    <p><strong>Spots left:</strong> {{ spots_left }}</p>

    <div class="mt-3">
        {% if user.is_authenticated %}
            {% if booked %}
                <a href="{% url 'cancel_booking' class.id %}" class="btn btn-danger">Cancel Booking</a>
            {% elif spots_left > 0 %}
                <!-- One-time payment booking form -->
                <form action="{% url 'create_checkout_session' %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="class_id" value="{{ class.id }}">
                    <button type="submit" class="btn btn-success">Book & Pay for This Class ($15)</button>
                </form>

                <!-- Subscription button -->
                <form action="{% url 'create_subscription_session' %}" method="POST" style="display:inline; margin-left:10px;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Subscribe Monthly</button>
                </form>
            {% else %}
                <button class="btn btn-secondary" disabled>Fully Booked</button>
            {% endif %}
        {% else %}
            <a href="{% url 'account_login' %}" class="btn btn-primary">Log in to book</a>
        {% endif %}
    </div>
</div>
{% endblock %}
